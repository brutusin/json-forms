<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href='lib/bootstrap.min.css'/>
        <link rel="stylesheet" href="lib/codemirror.css">
        <link rel="stylesheet" href='src/brutusin-json-forms.css'/>
        <style>
            .CodeMirror {
                height: 400px; 
            }
        </style>

        <script src='lib/jquery-1.11.3.min.js'></script>
        <script src='lib/bootstrap.min.js'></script>
        <script src="lib/codemirror.js"></script>
        <script src="lib/codemirror-javascript.js"></script>
        <script src="src/brutusin-json-forms.js"></script>
        <script src="src/brutusin-json-forms-bootstrap.js"></script>
        <script src="src/brutusin-json-forms-jsonsrv.js"></script>

        <script lang="javascript">
            var codeMirrors = new Object();
            var input = new Object();
            var inputString = new Object();
            var demos = [
                ["Simple",
                    {"$schema": "http://json-schema.org/draft-03/schema#", "title": "A boolean", "description": "A simple boolean data type as schema root", "type": "boolean"},
                    null],
                ["Objects, arrays, enums, default, required",
                    {"$schema":"http://json-schema.org/draft-03/schema#","type":"object","properties":{"pageNum":{"type":"integer","title":"Page number","description":"Page number to be queried, 1-based","default":1,"required":true},"pageSize":{"type":"integer","title":"Page size","description":"Number of records per page","required":true,"default":50,"enum":[10,25,50,100]},"selectedFacetValues":{"type":"array","title":"Query terms","items":{"type":"object","properties":{"facetName":{"type":"string","title":"Field name","description":"Indexed field name","required":true},"matchAllNull":{"type":"boolean","title":"Match nulls"},"matchAllNotNull":{"type":"boolean","title":"Match not nulls"},"facetValues":{"type":"array","title":"Field values","items":{"type":"object","properties":{"value":{"type":"string","title":"Value"}}}},"included":{"type":"boolean","title":"Included"}}}},"sorts":{"type":"array","title":"Sorting","items":{"type":"object","properties":{"fieldName":{"type":"string","title":"Field name"},"ascending":{"type":"boolean","title":"Ascending"}}}}}},
                    null],
                ["Initial data",
                    {"$schema":"http://json-schema.org/draft-03/schema#","type":"object","properties":{"pageNum":{"type":"integer","title":"Page number","description":"Page number to be queried, 1-based","default":1,"required":true},"pageSize":{"type":"integer","title":"Page size","description":"Number of records per page","required":true,"default":50,"enum":[10,25,50,100]},"selectedFacetValues":{"type":"array","title":"Query terms","items":{"type":"object","properties":{"facetName":{"type":"string","title":"Field name","description":"Indexed field name","required":true},"matchAllNull":{"type":"boolean","title":"Match nulls"},"matchAllNotNull":{"type":"boolean","title":"Match not nulls"},"facetValues":{"type":"array","title":"Field values","items":{"type":"object","properties":{"value":{"type":"string","title":"Value"}}}},"included":{"type":"boolean","title":"Included"}}}},"sorts":{"type":"array","title":"Sorting","items":{"type":"object","properties":{"fieldName":{"type":"string","title":"Field name"},"ascending":{"type":"boolean","title":"Ascending"}}}}}},
                    { "pageNum": 1, "pageSize": 50, "selectedFacetValues": [ { "facetName": "id", "matchAllNull": false, "matchAllNotNull": true, "facetValues": [ { "value": "1223" } ], "included": false } ], "sorts": [ { "fieldName": "name", "ascending": true } ] }],
                ["Additional properties",
                    {"$schema":"http://json-schema.org/draft-03/schema#","type":"object","additionalProperties":{"type":"object","properties":{"name":{"type":"string"},"age":{"type":"string"}}}},
                    {"aloha": {"name": "nacho", "age": 36}}]
            ];
            var selectedTab = "schema";
            var bf;

            function selectExample(selectedExampleIndex) {
                input.schema = demos[selectedExampleIndex][1];
                input.data = demos[selectedExampleIndex][2];
                inputString.schema = JSON.stringify(input.schema, null, 2);
                inputString.data = input.data ? JSON.stringify(input.data, null, 2) : "";
                if (codeMirrors[selectedTab]) {
                    codeMirrors[selectedTab].setValue(inputString[selectedTab]);
                }
            }
            selectExample(0);
            function generateForm() {
                var schema;
                var data;
                inputString[selectedTab] = codeMirrors[selectedTab].getValue();
                try {
                    eval("schema=" + inputString.schema);
                    if (inputString.data) {
                        eval("data=" + inputString.data);
                    } else {
                        data = null;
                    }
                } catch (err) {
                    $("#jsonAlert").show();
                    return;
                }
                $('#formLink').click();
                bf = BrutusinForms.create(schema);
                var container = document.getElementById('container');
                while (container.firstChild) {
                    container.removeChild(container.firstChild);
                }
                bf.render(container, data);
            }

        </script>

    </head>
    <body>
        <div class="container" >
            <h1><code>brutusin:json-forms</code> demo</h1>

            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                <div class="panel panel-primary">
                    <div class="panel-heading" role="tab" id="headingOne">
                        <h4 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseInput" aria-expanded="true" aria-controls="collapseInput">
                                Input
                            </a>
                        </h4>
                    </div>
                    <div id="collapseInput" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                        <div class="panel-body">
                            <label for="examples">Predefined examples:</label>
                            <select class="form-control" id="examples" onchange="selectExample(selectedIndex)">
                                <script>
                                    for (var i = 0; i < demos.length; i++) {
                                        document.write("<option>" + demos[i][0] + "</option>");
                                    }
                                </script>
                            </select>
                            <br>
                            <ul class="nav nav-tabs" role="tablist">
                                <li role="presentation" class="active"><a href="#schema" aria-controls="schema" role="tab" data-toggle="tab">Schema</a></li>
                                <li role="presentation"><a href="#data" aria-controls="data" role="tab" data-toggle="tab">Initial data</a></li>
                            </ul>
                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="schema"></div>
                                <div role="tabpanel" class="tab-pane" id="data"></div>
                            </div>
                            <div class="alert alert-danger in" role="alert" id="jsonAlert" style="display:none">
                                <a href="#" onclick='$("#jsonAlert").hide();' class="close" >&times;</a>
                                <strong>Error!</strong> There was a problem parsing the input JSON.
                            </div>

                        </div>

                        <div class="panel-footer">
                            <button class="btn btn-primary" onclick="generateForm()">Create form</button> 
                        </div>
                    </div>
                </div>
                <div class="panel panel-primary">
                    <div class="panel-heading" role="tab" id="headingTwo">
                        <h4 class="panel-title">
                            <a class="collapsed" id="formLink" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseForm" aria-expanded="false" aria-controls="collapseForm">
                                Generated form
                            </a>
                        </h4>
                    </div>
                    <div id="collapseForm" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                        <div id='container' class="panel-body"></div>
                        <div class="panel-footer">
                            <button class="btn btn-primary" onclick="document.write(JSON.stringify(bf.getData(), null, 4))">getData()</button>&nbsp;<button class="btn btn-primary" onclick="alert(bf.validate())">validate()</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <script lang="javascript">

            codeMirrors["schema"] = CodeMirror(document.getElementById("schema"), {
                value: JSON.stringify(demos[0][1], null, 4),
                mode: "javascript",
                lineNumbers: true
            });
            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                selectedTab = $(e.target).attr("aria-controls");
                var pt = $(e.relatedTarget);
                var prevTab;
                if (pt) {
                    prevTab = pt.attr("aria-controls");
                    inputString[prevTab] = codeMirrors[prevTab].getValue();
                }
                if (!codeMirrors[selectedTab]) {
                    codeMirrors[selectedTab] = CodeMirror(document.getElementById(selectedTab), {
                        mode: "javascript",
                        lineNumbers: true
                    });
                }
                codeMirrors[selectedTab].setValue(inputString[selectedTab]);
            }
            );
        </script>
    </div>
</body>
</html> 